<!DOCTYPE html>
<html lang = "en">

<head>
<meta charset="utf-8utf-8">
    <title>songtrack_backend.js</title>
    <link rel="stylesheet" type="text/css" href="static/css/tracks-sw.css">
    <link rel="stylesheet" href="../static/css/build-music-visualizer.css">
    <link rel="stylesheet" type="text/css" href="static/css/bootstrap.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <link rel="stylesheet" type="text/css" href="static/css/fontawesome.css"> -->

    <script src = "../static/js/build-music-visualizer/jquery.min.js"></script>
    <script type="text/javascript" src="static/js/vendor/d3.v4.js"></script>

		<script src = "../static/js/build-music-visualizer/build-music-visualizer-web-audio-api.js"></script>
		<script src = "../static/js/build-music-visualizer/build-music-visualizer-render.js"></script>
		<script src = "../static/js/build-music-visualizer/build-music-visualizer-web-audio.js"></script>

    <script src="static/js/main.js" type="module"></script>
    <!-- https://www.npmjs.com/package/music-tempo -->
    <script src="static/js/music-tempo.min.js"></script>

    <div class = "head" title="Music mixer">Music - Mixer</div>
</head>

<body>

<div class = 'box00' >
    <div class = "div01">
      <!-- <div class = "divd3" id="chartForTrack"></div> -->
      <svg id = 'd3-svg' width="1360" height="365" style="border: 1px solid #E0FFFF;" padding = "10px" margin = '10px'></svg>
    </div>

    <div class="grid-container">
      <div class="playbox">
        <canvas id = "analyser_render" style="border: 1px solid #000;"></canvas>
      </div>

<!-- https://fontawesome.com/icons/bold?style=solid  about icon graphs-->
<!-- https://codepen.io/superpikar/pen/zJsgH -->
      <div class = "playbox">
          <button type="button" class="btn">
               <i style="font-size:22px" class="fa">&#xf031;</i>
          </button>
          <button type="button" id="button_play1" class="btn">
               <i style="font-size:22px" class="fa fa-play"></i>
          </button>
          <button type="button" id="button_stop1" class="btn">
               <i style="font-size:22px" class="fa fa-stop"></i>
          </button>
      </div>

      <div class = "playbox">
          <button type="button" class="btn">
               <i style="font-size:22px" class="fa">&#xf032;</i>
          </button>
          <button type="button" id="button_play2" class="btn">
               <i style="font-size:22px" class="fa fa-play"></i>
          </button>
          <button type="button" id="button_stop2" class="btn">
               <i style="font-size:22px" class="fa fa-stop"></i>
          </button>
      </div>

      <div class = "playbox">
          <button type="button" class="btn">
               <i style="font-size:22px" class="fa">&#xf136;</i>
          </button>
          <button type="button" id="button_playM" class="btn">
               <i style="font-size:22px" class="fa fa-play"></i>
          </button>
          <button type="button" id="button_stopM" class="btn">
               <i style="font-size:22px" class="fa fa-stop"></i>
          </button>
      </div>

    </div>

    <div class = "div03">
      <div class = 'inputfile'>
          A: <input id = "fname01" type="file" accept="mp3/m4a"></input>
      </div>
      <div>
          <input id = "volumeControl" type="range" min="0" max="100" value="50"></input>
      </div>
      <div class = "inputfile">
          B: <input id = "fname02" type="file" accept="mp3/m4a"></input>
      </div>
    </div>

    <div id = "freq_graph">
         <div id = "audio_box">
           <audio controls></audio>
           <button class="song-btn">Play</button><br>
           <canvas id="fragment"></canvas><br>
         </div>

        <div class="sourceCode" id="vertex-shader">
          <script>
            attribute vec2 position;
            void main(void) {
              gl_Position = vec4(position, 0, 1);
            }
          </script>
        </div>

        <div class="sourceCode" id="fragment-shader">
          <script>
            precision mediump float;
            uniform float time;
            uniform vec2 resolution;
            uniform sampler2D spectrum;

            void main(void) {
              vec3 c;
              float z = 0.1 * time;
              vec2 uv = gl_FragCoord.xy / resolution;
              vec2 p = uv - 0.5;
              p.x *= resolution.x / resolution.y;
              float l = 0.2 * length(p);
              for (int i = 0; i < 3; i++) {
                z += 0.07;
                uv += p / l * (sin(z) + 1.0) * abs(sin(l * 9.0 - z * 2.0));
                c[i] = 0.01 / length(abs(mod(uv, 1.0) - 0.5));
              }
              float intensity = texture2D(spectrum, vec2(l, 0.5)).x;
              gl_FragColor = vec4(c / l * intensity, time);
            }
          </script>
        </div>

    <pre class="sourceCode javascript">
      <code class="sourceCode javascript">
        <span class="kw">const</span> analyser
        <span class="op">=</span>
        <span class="va">audioContext</span>.
        <span class="at">createAnalyser</span>()
        <span class="va">masterGain</span>.
        <span class="at">connect</span>(analyser)
        <span class="kw">const</span> waveform
        <span class="op">=</span>
        <span class="kw">new</span>
        <span class="at">Float32Array</span>(
        <span class="va">analyser</span>.
        <span class="at">frequencyBinCount</span>)
        <span class="va">analyser</span>.
        <span class="at">getFloatTimeDomainData</span>(waveform)
     </code>
    </pre>
    <!-- <script> // the replace js code for above section
      const analyser = audioContext.createAnalyser();
      masterGain.connect(analyser);
      const waveform = new Float32Array(analyser.frequencyBinCount);
      analyser.getFloatTimeDomainData(waveform);
    </script> -->

    <pre class="sourceCode javascript">
      <code class="sourceCode javascript">
        <span class="kw">const</span> spectrum
        <span class="op">=</span>
        <span class="kw">new</span>
        <span class="at">Uint8Array</span>(
        <span class="va">analyser</span>.
        <span class="at">frequencyBinCount</span>)
        <span class="op">;</span>(
        <span class="kw">function</span>
        <span class="at">updateSpectrum</span>()
        <span class="op">{</span>
        <span class="at">requestAnimationFrame</span>(updateSpectrum)
        <span class="va">analyser</span>.
        <span class="at">getByteFrequencyData</span>(spectrum)
        <span class="op">}</span>)()
      </code>
    </pre>
    <!-- <script> // the replace js code for above section
      const spectrum = new Uint8Array(analyser.frequencyBinCount);
      function updateSpectrum() {
        requestAnimationFrame(updateSpectrum);
        analyser.getByteFrequencyData(spectrum);
      }
    </script> -->

    <pre class="sourceCode javascript">
      <code class="sourceCode javascript">
        <span class="kw">const</span> fragCanvas
        <span class="op">=</span>
        <span class="va">document</span>.
        <span class="at">getElementById</span>(
        <span class="st">'fragment'</span>)
        <span class="va">fragCanvas</span>.
        <span class="at">width</span>
        <span class="op">=</span>
        <span class="va">fragCanvas</span>.
        <span class="va">parentNode</span>.
        <span class="at">offsetWidth</span>
        <span class="va">fragCanvas</span>.
        <span class="at">height</span>
        <span class="op">=</span>
        <span class="va">fragCanvas</span>.
        <span class="at">width</span>
        <span class="op">*</span>
        <span class="fl">0.75</span>
        <span class="kw">const</span> gl
        <span class="op">=</span>
        <span class="va">fragCanvas</span>.
        <span class="at">getContext</span>(
        <span class="st">'webgl'</span>)
        <span class="op">||</span>
        <span class="va">fragCanvas</span>.
        <span class="at">getContext</span>(
        <span class="st">'experimental-webgl'</span>)
        <span class="kw">const</span> vertexShaderSrc
        <span class="op">=</span>
        <span class="va">document</span>.
        <span class="at">getElementById</span>(
        <span class="st">'vertex-shader'</span>).
        <span class="at">textContent</span>
        <span class="kw">const</span> fragmentShaderSrc
        <span class="op">=</span> <span class="va">document</span>.
        <span class="at">getElementById</span>(
        <span class="st">'fragment-shader'</span>).
        <span class="at">textContent</span>
        <span class="kw">const</span> fragShader
        <span class="op">=</span> <span class="at">createShader</span>(gl
        <span class="op">,</span> vertexShaderSrc<span class="op">,
        </span> fragmentShaderSrc)
      </code>
    </pre>
    <!-- <script> // the replace js code for above section
      const fragCanvas = document.getElementById('fragment')
      fragCanvas.width = fragCanvas.parentNode.offsetWidth
      fragCanvas.height = fragCanvas.width * 0.75
      const gl = fragCanvas.getContext('webgl') || fragCanvas.getContext('experimental-webgl')
      const vertexShaderSrc = document.getElementById('vertex-shader').textContent
      const fragmentShaderSrc = document.getElementById('fragment-shader').textContent
      const fragShader = createShader(gl, vertexShaderSrc, fragmentShaderSrc)
    </script> -->


    <pre class="sourceCode javascript">
      <code class="sourceCode javascript">
        <span class="kw">const</span> fragPosition
        <span class="op">=</span>
        <span class="va">gl</span>.
        <span class="at">getAttribLocation</span>(fragShader
        <span class="op">,</span>
        <span class="st">'position'</span>)
        <span class="va">gl</span>.
        <span class="at">enableVertexAttribArray</span>(fragPosition)
        <span class="kw">const</span> fragTime
        <span class="op">=</span>
        <span class="va">gl</span>.
        <span class="at">getUniformLocation</span>(fragShader
        <span class="op">,</span>
        <span class="st">'time'</span>)
        <span class="va">gl</span>.
        <span class="at">uniform1f</span>(fragTime
        <span class="op">,</span>
        <span class="va">audioContext</span>.
        <span class="at">currentTime</span>)
        <span class="kw">const</span> fragResolution
        <span class="op">=</span>
        <span class="va">gl</span>.
        <span class="at">getUniformLocation</span>(fragShader
        <span class="op">,</span>
        <span class="st">'resolution'</span>)
        <span class="va">gl</span>.
        <span class="at">uniform2f</span>(fragResolution
        <span class="op">,</span>
        <span class="va">fragCanvas</span>.
        <span class="at">width</span>
        <span class="op">,</span>
        <span class="va">fragCanvas</span>.
        <span class="at">height</span>)
        <span class="kw">const</span> fragSpectrumArray
        <span class="op">=</span>
        <span class="kw">new</span>
        <span class="at">Uint8Array</span>(
        <span class="dv">4</span>
        <span class="op">*</span>
        <span class="va">spectrum</span>.
        <span class="at">length</span>)
        <span class="kw">const</span> fragSpectrum
        <span class="op">=</span>
        <span class="at">createTexture</span>(gl)
      </code>
    </pre>
    <!-- <script>  // the replace js code for above section
      const fragPosition = gl.getAttribLocation(fragShader, 'position');
      gl.enableVertexAttribArray(fragPosition);
      const fragTime = gl.getUniformLocation(fragShader, 'time');
      gl.uniform1f(fragTime, audioContext.currentTime);
      const fragResolution = gl.getUniformLocation(fragShader, 'resolution');
      gl.uniform2f(fragResolution, fragCanvas.width, fragCanvas.height);
      const fragSpectrumArray = new Uint8Array(4 * spectrum.length);
      const fragSpectrum = createTexture(gl);
    </script> -->

    <pre class="sourceCode javascript">
      <code class="sourceCode javascript">
        <span class="at">initQuad</span>(gl)
        <span class="op">;</span>(
        <span class="kw">function</span>
        <span class="at">renderFragment</span>()
        <span class="op">{</span>
        <span class="at">requestAnimationFrame</span>(renderFragment)
        <span class="va">gl</span>.
        <span class="at">uniform1f</span>(fragTime
        <span class="op">,</span>
        <span class="va">audioContext</span>.
        <span class="at">currentTime</span>)
        <span class="at">copyAudioDataToTexture</span>(gl
        <span class="op">,</span> spectrum
        <span class="op">,</span> fragSpectrumArray)
        <span class="at">renderQuad</span>(gl)
        <span class="op">}</span>)()
      </code>
    </pre>
    <!-- <script> // the replace js code for above section -->
      <!-- initQuad(gl);
      function renderFragment() {
        requestAnimationFrame(renderFragment);
        gl.uniform1f(fragTime, audioContext.currentTime);
        copyAudioDataToTexture(gl, spectrum, fragSpectrumArray);
        renderQuad(gl)
      } -->
    <!-- </script> -->

    <!-- </article> -->
    </div>

</div>
</body>

</html>
