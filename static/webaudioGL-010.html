<!-- https://noisehack.com/build-music-visualizer-web-audio-api/-->
<!-- dislay frequencies while playing laserlike graph-->
<!doctype html>
<html lang="en-us">
<head>
		<meta charset="utf-8">
		<title>Build a Music Visualizer with the Web Audio API</title>
		<meta name="description" content="Basics of music visualization using the Web Audio API.">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="stylesheet" href="../static/css/build-music-visualizer.css">

		<script>
		   window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
		   ga('create', 'UA-15976986-14', 'auto');
		   ga('send', 'pageview');
		</script>
    <script src = "../static/js/build-music-visualizer/jquery.min.js"></script>
		<script src = "../static/js/build-music-visualizer/build-music-visualizer-web-audio-api.js"></script>
		<script src = "../static/js/build-music-visualizer/build-music-visualizer-render.js"></script>
		<script src = "../static/js/build-music-visualizer/build-music-visualizer-web-audio.js"></script>
</head>

<body>
  <div id="container">
    <article>
			<p>
				<canvas id="fragment"></canvas>
			</p>

			<p>
				<button class="song-btn">Play Song</button>
			</p>

			<div class="sourceCode" id="vertex-shader">
				<script>
					attribute vec2 position;
					void main(void) {
						gl_Position = vec4(position, 0, 1);
					}
				</script>
			</div>

			<div class="sourceCode" id="fragment-shader">
				<script>
					precision mediump float;
					uniform float time;
					uniform vec2 resolution;
					uniform sampler2D spectrum;

					void main(void) {
						vec3 c;
						float z = 0.1 * time;
						vec2 uv = gl_FragCoord.xy / resolution;
						vec2 p = uv - 0.5;
						p.x *= resolution.x / resolution.y;
						float l = 0.2 * length(p);
						for (int i = 0; i < 3; i++) {
							z += 0.07;
							uv += p / l * (sin(z) + 1.0) * abs(sin(l * 9.0 - z * 2.0));
							c[i] = 0.01 / length(abs(mod(uv, 1.0) - 0.5));
						}
						float intensity = texture2D(spectrum, vec2(l, 0.5)).x;
						gl_FragColor = vec4(c / l * intensity, time);
					}
				</script>
			</div>

	<pre class="sourceCode javascript">
		<code class="sourceCode javascript">
			<span class="kw">const</span> analyser
			<span class="op">=</span>
			<span class="va">audioContext</span>.
			<span class="at">createAnalyser</span>()
      <span class="va">masterGain</span>.
			<span class="at">connect</span>(analyser)
      <span class="kw">const</span> waveform
	    <span class="op">=</span>
	    <span class="kw">new</span>
	    <span class="at">Float32Array</span>(
			<span class="va">analyser</span>.
			<span class="at">frequencyBinCount</span>)
      <span class="va">analyser</span>.
			<span class="at">getFloatTimeDomainData</span>(waveform)
   </code>
  </pre>
  <!-- <script> // the replace js code for above section
    const analyser = audioContext.createAnalyser();
    masterGain.connect(analyser);
    const waveform = new Float32Array(analyser.frequencyBinCount);
    analyser.getFloatTimeDomainData(waveform);
  </script> -->

	<!-- <script> // the replace js code for all
			const analyser = audioContext.createAnalyser();
			masterGain.connect(analyser);
			const waveform = new Float32Array(analyser.frequencyBinCount);
			analyser.getFloatTimeDomainData(waveform);
		const spectrum = new Uint8Array(analyser.frequencyBinCount);
	  function updateSpectrum() {
	    requestAnimationFrame(updateSpectrum);
	    analyser.getByteFrequencyData(spectrum);
	  }


		const fragCanvas = document.getElementById('fragment');
		fragCanvas.width = fragCanvas.parentNode.offsetWidth;
		fragCanvas.height = fragCanvas.width * 0.75;
		const gl = fragCanvas.getContext('webgl') || fragCanvas.getContext('experimental-webgl');
		const vertexShaderSrc = document.getElementById('vertex-shader').textContent;
		const fragmentShaderSrc = document.getElementById('fragment-shader').textContent;
		const fragShader = createShader(gl, vertexShaderSrc, fragmentShaderSrc);


		const fragPosition = gl.getAttribLocation(fragShader, 'position');
		gl.enableVertexAttribArray(fragPosition);
		const fragTime = gl.getUniformLocation(fragShader, 'time');
		gl.uniform1f(fragTime, audioContext.currentTime);
		const fragResolution = gl.getUniformLocation(fragShader, 'resolution');
		gl.uniform2f(fragResolution, fragCanvas.width, fragCanvas.height);
		const fragSpectrumArray = new Uint8Array(4 * spectrum.length);
		const fragSpectrum = createTexture(gl);


		initQuad(gl);
		function renderFragment() {
			requestAnimationFrame(renderFragment);
			gl.uniform1f(fragTime, audioContext.currentTime);
			copyAudioDataToTexture(gl, spectrum, fragSpectrumArray);
			renderQuad(gl)
		}
  </script> -->

	<pre class="sourceCode javascript">
		<code class="sourceCode javascript">
			<span class="kw">const</span> spectrum
			<span class="op">=</span>
			<span class="kw">new</span>
			<span class="at">Uint8Array</span>(
			<span class="va">analyser</span>.
			<span class="at">frequencyBinCount</span>)
      <span class="op">;</span>(
			<span class="kw">function</span>
		  <span class="at">updateSpectrum</span>()
			<span class="op">{</span>
      <span class="at">requestAnimationFrame</span>(updateSpectrum)
      <span class="va">analyser</span>.
			<span class="at">getByteFrequencyData</span>(spectrum)
      <span class="op">}</span>)()
		</code>
	</pre>
	<!-- <script> // the replace js code for above section
	  const spectrum = new Uint8Array(analyser.frequencyBinCount);
	  function updateSpectrum() {
	    requestAnimationFrame(updateSpectrum);
	    analyser.getByteFrequencyData(spectrum);
	  }
	</script> -->

	<pre class="sourceCode javascript">
		<code class="sourceCode javascript">
			<span class="kw">const</span> fragCanvas
			<span class="op">=</span>
			<span class="va">document</span>.
			<span class="at">getElementById</span>(
			<span class="st">'fragment'</span>)
      <span class="va">fragCanvas</span>.
			<span class="at">width</span>
			<span class="op">=</span>
			<span class="va">fragCanvas</span>.
			<span class="va">parentNode</span>.
			<span class="at">offsetWidth</span>
      <span class="va">fragCanvas</span>.
			<span class="at">height</span>
			<span class="op">=</span>
			<span class="va">fragCanvas</span>.
			<span class="at">width</span>
			<span class="op">*</span>
			<span class="fl">0.75</span>
      <span class="kw">const</span> gl
			<span class="op">=</span>
			<span class="va">fragCanvas</span>.
			<span class="at">getContext</span>(
			<span class="st">'webgl'</span>)
			<span class="op">||</span>
			<span class="va">fragCanvas</span>.
			<span class="at">getContext</span>(
			<span class="st">'experimental-webgl'</span>)
      <span class="kw">const</span> vertexShaderSrc
			<span class="op">=</span>
			<span class="va">document</span>.
			<span class="at">getElementById</span>(
			<span class="st">'vertex-shader'</span>).
			<span class="at">textContent</span>
      <span class="kw">const</span> fragmentShaderSrc
			<span class="op">=</span> <span class="va">document</span>.
			<span class="at">getElementById</span>(
			<span class="st">'fragment-shader'</span>).
			<span class="at">textContent</span>
      <span class="kw">const</span> fragShader
			<span class="op">=</span> <span class="at">createShader</span>(gl
			<span class="op">,</span> vertexShaderSrc<span class="op">,
			</span> fragmentShaderSrc)
    </code>
  </pre>
	<!-- <script> // the replace js code for above section
	  const fragCanvas = document.getElementById('fragment')
	  fragCanvas.width = fragCanvas.parentNode.offsetWidth
	  fragCanvas.height = fragCanvas.width * 0.75
	  const gl = fragCanvas.getContext('webgl') || fragCanvas.getContext('experimental-webgl')
	  const vertexShaderSrc = document.getElementById('vertex-shader').textContent
	  const fragmentShaderSrc = document.getElementById('fragment-shader').textContent
	  const fragShader = createShader(gl, vertexShaderSrc, fragmentShaderSrc)
	</script> -->


	<pre class="sourceCode javascript">
		<code class="sourceCode javascript">
			<span class="kw">const</span> fragPosition
			<span class="op">=</span>
			<span class="va">gl</span>.
			<span class="at">getAttribLocation</span>(fragShader
		  <span class="op">,</span>
			<span class="st">'position'</span>)
      <span class="va">gl</span>.
			<span class="at">enableVertexAttribArray</span>(fragPosition)
      <span class="kw">const</span> fragTime
			<span class="op">=</span>
			<span class="va">gl</span>.
			<span class="at">getUniformLocation</span>(fragShader
		  <span class="op">,</span>
		  <span class="st">'time'</span>)
      <span class="va">gl</span>.
			<span class="at">uniform1f</span>(fragTime
			<span class="op">,</span>
			<span class="va">audioContext</span>.
			<span class="at">currentTime</span>)
      <span class="kw">const</span> fragResolution
			<span class="op">=</span>
			<span class="va">gl</span>.
			<span class="at">getUniformLocation</span>(fragShader
		  <span class="op">,</span>
			<span class="st">'resolution'</span>)
      <span class="va">gl</span>.
			<span class="at">uniform2f</span>(fragResolution
			<span class="op">,</span>
			<span class="va">fragCanvas</span>.
			<span class="at">width</span>
		  <span class="op">,</span>
			<span class="va">fragCanvas</span>.
			<span class="at">height</span>)
      <span class="kw">const</span> fragSpectrumArray
			<span class="op">=</span>
			<span class="kw">new</span>
			<span class="at">Uint8Array</span>(
			<span class="dv">4</span>
			<span class="op">*</span>
			<span class="va">spectrum</span>.
			<span class="at">length</span>)
      <span class="kw">const</span> fragSpectrum
			<span class="op">=</span>
			<span class="at">createTexture</span>(gl)
    </code>
  </pre>
	<!-- <script>  // the replace js code for above section
	  const fragPosition = gl.getAttribLocation(fragShader, 'position');
	  gl.enableVertexAttribArray(fragPosition);
	  const fragTime = gl.getUniformLocation(fragShader, 'time');
	  gl.uniform1f(fragTime, audioContext.currentTime);
	  const fragResolution = gl.getUniformLocation(fragShader, 'resolution');
	  gl.uniform2f(fragResolution, fragCanvas.width, fragCanvas.height);
	  const fragSpectrumArray = new Uint8Array(4 * spectrum.length);
	  const fragSpectrum = createTexture(gl);
	</script> -->

	<pre class="sourceCode javascript">
		<code class="sourceCode javascript">
			<span class="at">initQuad</span>(gl)
      <span class="op">;</span>(
			<span class="kw">function</span>
		  <span class="at">renderFragment</span>()
			<span class="op">{</span>
      <span class="at">requestAnimationFrame</span>(renderFragment)
      <span class="va">gl</span>.
			<span class="at">uniform1f</span>(fragTime
		  <span class="op">,</span>
			<span class="va">audioContext</span>.
			<span class="at">currentTime</span>)
      <span class="at">copyAudioDataToTexture</span>(gl
			<span class="op">,</span> spectrum
			<span class="op">,</span> fragSpectrumArray)
      <span class="at">renderQuad</span>(gl)
      <span class="op">}</span>)()
    </code>
  </pre>
	<!-- <script> // the replace js code for above section -->
	  <!-- initQuad(gl);
		function renderFragment() {
	    requestAnimationFrame(renderFragment);
	    gl.uniform1f(fragTime, audioContext.currentTime);
	    copyAudioDataToTexture(gl, spectrum, fragSpectrumArray);
	    renderQuad(gl)
	  } -->
	<!-- </script> -->

	</article>
</div>
</body>

</html>
